# K3s Agent Configuration for Low-Power Android Devices
# Optimized for 2GB-4GB RAM devices running on ARM64

# Security Hardening
# ------------------
# Protect kernel defaults where possible (though Android kernels may restrict this)
# protect-kernel-defaults: true

# Node Setup
node-label:
  - "device_type=android"
  - "power_profile=low"

# Kubelet Customizations for Low Resources
kubelet-arg:
  # Garbage Collection - Aggressive cleanup
  - "image-gc-high-threshold=75"
  - "image-gc-low-threshold=60"
  # Eviction - Protect node from OOM freezing
  - "eviction-hard=memory.available<200Mi,nodefs.available<5%"
  - "eviction-soft=memory.available<500Mi,nodefs.available<10%"
  - "eviction-soft-grace-period=memory.available=1m,nodefs.available=1m"
  # Battery Saving: Reduce update frequency
  - "node-status-update-frequency=20s"

# Container Runtime
# K3s will automatically detect if cgroupfs or systemd is appropriate,
# but 'cgroupfs' is safer for many Android setups if systemd isn't fully emulated.
# container-runtime-endpoint: unix:///run/k3s/containerd/containerd.sock

# Network
# Flannel backend: 'vxlan' is the most compatible default.
flannel-backend: vxlan

# Authentication
# Ensure your kubelet config file is chmod 600 after creation
